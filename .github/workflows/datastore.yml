name: Run DataStore Script

on:
  schedule:
    # Schedule at 9:00 AM IST (3:30 AM UTC) on weekdays
    # Average delay is 25-27 min, so script will wait until 9:29 AM if early
    - cron: '30 3 * * 1-5'
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Force run regardless of time/weekday checks'
        required: false
        default: 'false'

jobs:
  run-datastore:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install yfinance 0.2.61
        run: pip install yfinance==0.2.61

      - name: Run DataStore.py
        env:
          RUN_FORCE: ${{ github.event.inputs.force_run == 'true' && 'true' || 'false' }}
        run: |
          echo "=== Workflow Triggered ==="
          echo "UTC time: $(date -u +'%Y-%m-%d %H:%M:%S')"
          echo "IST time: $(TZ='Asia/Kolkata' date +'%Y-%m-%d %H:%M:%S')"
          echo "Day: $(TZ='Asia/Kolkata' date +'%A')"
          echo "Force Run: $RUN_FORCE"
          echo "=== Starting Download ==="
          python DataStore.py
        continue-on-error: true

      - name: Verify results
        run: |
          echo "=== Download Results ==="
          if [ -d "results_pkl" ]; then
            echo "✓ Results saved successfully"
            ls -lh results_pkl/ | tail -5
          else
            echo "⚠ No results directory found"
          fi



